<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Agent Collaboration Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        h1 {
            color: #f97316;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        .subtitle {
            color: #888;
            font-size: 1.1em;
        }
        .concept-box {
            background: rgba(249, 115, 22, 0.1);
            border: 1px solid rgba(249, 115, 22, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .concept-box h3 {
            color: #f97316;
            margin-bottom: 10px;
        }
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }
        .controls {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #f97316;
            font-weight: 500;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 14px;
        }
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 10px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: #fff;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(249, 115, 22, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .visualization {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .agents-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .agent-card {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }
        .agent-card.active {
            border-color: #f97316;
            box-shadow: 0 0 30px rgba(249, 115, 22, 0.3);
        }
        .agent-card.speaking {
            animation: pulse 0.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .agent-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin: 0 auto 10px;
        }
        .leader .agent-avatar { background: linear-gradient(135deg, #f97316, #ea580c); }
        .worker .agent-avatar { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .critic .agent-avatar { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .memory .agent-avatar { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .agent-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .agent-role {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
        }
        .agent-status {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
        }
        .agent-status.active { background: #22c55e; }
        .agent-status.thinking { background: #fbbf24; animation: blink 0.5s infinite; }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .communication-panel {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .panel-title {
            font-weight: 600;
            color: #f97316;
        }
        .messages-container {
            max-height: 300px;
            overflow-y: auto;
        }
        .message {
            display: flex;
            gap: 12px;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .message.from-leader .message-avatar { background: linear-gradient(135deg, #f97316, #ea580c); }
        .message.from-worker .message-avatar { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .message.from-critic .message-avatar { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .message.from-memory .message-avatar { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .message-content {
            flex: 1;
        }
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .message-sender {
            font-weight: 600;
            font-size: 13px;
        }
        .message-type {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
        }
        .message-text {
            font-size: 13px;
            color: #ccc;
            line-height: 1.5;
        }
        .task-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .task-card {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
        }
        .task-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #f97316;
        }
        .subtask {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 13px;
        }
        .subtask-status {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }
        .subtask-status.pending { background: #666; }
        .subtask-status.progress { background: #fbbf24; color: #000; }
        .subtask-status.done { background: #22c55e; }
        .subtask-status.review { background: #ef4444; }
        .topology-select {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .topology-option {
            background: rgba(0,0,0,0.3);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .topology-option:hover {
            border-color: rgba(249, 115, 22, 0.5);
        }
        .topology-option.selected {
            border-color: #f97316;
            background: rgba(249, 115, 22, 0.1);
        }
        .topology-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .topology-name {
            font-size: 11px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Multi-Agent Collaboration Simulator</h1>
            <p class="subtitle">Leader-Worker-Critic Pattern with Role-Based Coordination</p>
        </header>

        <div class="concept-box">
            <h3>Concept from "Agentic Reasoning" Survey (Pages 30, 34)</h3>
            <p>Multi-agent systems coordinate through specialized roles and communication:</p>
            <ul>
                <li><strong>Leader/Coordinator:</strong> Sets goals, decomposes tasks, arbitrates conflicts</li>
                <li><strong>Worker/Executor:</strong> Performs concrete actions - code, retrieve, execute</li>
                <li><strong>Critic/Evaluator:</strong> Quality assurance, testing, red-teaming</li>
                <li><strong>Memory Keeper:</strong> Maintains shared context and knowledge</li>
            </ul>
            <p style="margin-top:10px;"><em>"Effective multi-agent systems mirror human organizations: clear responsibilities, communication channels, and accountability."</em></p>
        </div>

        <div class="main-content">
            <div class="controls">
                <div class="control-group">
                    <label>Task to Execute</label>
                    <select id="taskSelect">
                        <option value="code">Build a REST API endpoint</option>
                        <option value="research">Research competitor analysis</option>
                        <option value="debug">Debug authentication issue</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Collaboration Topology</label>
                    <div class="topology-select">
                        <div class="topology-option selected" onclick="selectTopology('hierarchical', this)">
                            <div class="topology-icon">üèõÔ∏è</div>
                            <div class="topology-name">Hierarchical</div>
                        </div>
                        <div class="topology-option" onclick="selectTopology('flat', this)">
                            <div class="topology-icon">üîÑ</div>
                            <div class="topology-name">Flat/P2P</div>
                        </div>
                        <div class="topology-option" onclick="selectTopology('cascade', this)">
                            <div class="topology-icon">‚õìÔ∏è</div>
                            <div class="topology-name">Cascade</div>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Animation Speed (ms)</label>
                    <input type="range" id="speed" min="300" max="2000" value="800">
                </div>

                <button class="btn-primary" onclick="runCollaboration()">Start Collaboration</button>
                <button class="btn-secondary" onclick="stepCollaboration()">Step</button>
                <button class="btn-secondary" onclick="resetCollaboration()">Reset</button>

                <div style="margin-top:20px; padding:15px; background:rgba(0,0,0,0.2); border-radius:10px;">
                    <div style="color:#f97316; font-weight:600; margin-bottom:10px;">Collaboration Stats</div>
                    <div style="font-size:13px; color:#888;">
                        <div>Messages Sent: <span id="msgCount">0</span></div>
                        <div>Tasks Completed: <span id="taskCount">0/4</span></div>
                        <div>Iterations: <span id="iterCount">0</span></div>
                    </div>
                </div>
            </div>

            <div class="visualization">
                <div class="agents-panel">
                    <div class="agent-card leader" id="agent-leader">
                        <div class="agent-status"></div>
                        <div class="agent-avatar">üëî</div>
                        <div class="agent-name">Coordinator</div>
                        <div class="agent-role">Leader</div>
                    </div>
                    <div class="agent-card worker" id="agent-worker1">
                        <div class="agent-status"></div>
                        <div class="agent-avatar">‚öôÔ∏è</div>
                        <div class="agent-name">Developer</div>
                        <div class="agent-role">Worker</div>
                    </div>
                    <div class="agent-card critic" id="agent-critic">
                        <div class="agent-status"></div>
                        <div class="agent-avatar">üîç</div>
                        <div class="agent-name">Reviewer</div>
                        <div class="agent-role">Critic</div>
                    </div>
                    <div class="agent-card memory" id="agent-memory">
                        <div class="agent-status"></div>
                        <div class="agent-avatar">üß†</div>
                        <div class="agent-name">Knowledge</div>
                        <div class="agent-role">Memory</div>
                    </div>
                </div>

                <div class="communication-panel">
                    <div class="panel-header">
                        <span class="panel-title">Agent Communication Channel</span>
                        <span style="font-size:12px; color:#888;">Real-time message passing</span>
                    </div>
                    <div class="messages-container" id="messages">
                        <div style="color:#666; text-align:center; padding:30px;">
                            Start the collaboration to see agent communication...
                        </div>
                    </div>
                </div>

                <div class="task-panel">
                    <div class="task-card">
                        <div class="task-title">Task Breakdown</div>
                        <div id="subtasks">
                            <div class="subtask">
                                <div class="subtask-status pending">1</div>
                                <span>Analyze requirements</span>
                            </div>
                            <div class="subtask">
                                <div class="subtask-status pending">2</div>
                                <span>Implement solution</span>
                            </div>
                            <div class="subtask">
                                <div class="subtask-status pending">3</div>
                                <span>Review and test</span>
                            </div>
                            <div class="subtask">
                                <div class="subtask-status pending">4</div>
                                <span>Integrate and deploy</span>
                            </div>
                        </div>
                    </div>
                    <div class="task-card">
                        <div class="task-title">Shared Memory</div>
                        <div id="sharedMemory" style="font-size:13px; color:#888;">
                            <div style="padding:10px; background:rgba(255,255,255,0.05); border-radius:6px; margin-bottom:6px;">
                                Project: REST API Development
                            </div>
                            <div style="padding:10px; background:rgba(255,255,255,0.05); border-radius:6px;">
                                Status: Awaiting start...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scenarios = {
            code: {
                name: 'Build REST API',
                steps: [
                    { agent: 'leader', type: 'directive', text: 'Team, we need to build a REST API endpoint for user authentication. Let me break this down into subtasks.' },
                    { agent: 'leader', type: 'assignment', text: 'Knowledge Agent: Please retrieve our API design patterns and authentication standards.' },
                    { agent: 'memory', type: 'response', text: 'Retrieved: We use JWT tokens, bcrypt for passwords, and follow RESTful conventions. Rate limiting is 100 req/min.' },
                    { agent: 'leader', type: 'assignment', text: 'Developer: Implement the /auth/login endpoint following these patterns.' },
                    { agent: 'worker1', type: 'progress', text: 'Starting implementation. Creating route handler with input validation...' },
                    { agent: 'worker1', type: 'response', text: 'Implementation complete: POST /auth/login with email/password validation, JWT generation, and error handling.' },
                    { agent: 'leader', type: 'assignment', text: 'Reviewer: Please evaluate the implementation for security and best practices.' },
                    { agent: 'critic', type: 'review', text: 'Review findings: 1) Missing rate limiting middleware, 2) Should add refresh token support, 3) Good input sanitization.' },
                    { agent: 'leader', type: 'directive', text: 'Developer: Please address the rate limiting issue. We can defer refresh tokens to v2.' },
                    { agent: 'worker1', type: 'response', text: 'Added rate limiting middleware. Implementation updated and ready for final review.' },
                    { agent: 'critic', type: 'approval', text: 'Approved. Implementation meets security standards. Ready for integration.' },
                    { agent: 'memory', type: 'update', text: 'Storing: New endpoint /auth/login added. Pattern: JWT + rate limiting. Owner: Developer Agent.' },
                    { agent: 'leader', type: 'complete', text: 'Task complete! API endpoint is implemented, reviewed, and documented. Great collaboration, team.' }
                ]
            }
        };

        let currentScenario = 'code';
        let currentStep = 0;
        let running = false;
        let messageCount = 0;
        let completedTasks = 0;
        let topology = 'hierarchical';

        function selectTopology(type, el) {
            topology = type;
            document.querySelectorAll('.topology-option').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
        }

        function setAgentActive(agentId, status = 'active') {
            document.querySelectorAll('.agent-card').forEach(card => {
                card.classList.remove('active', 'speaking');
                card.querySelector('.agent-status').classList.remove('active', 'thinking');
            });

            if (agentId) {
                const card = document.getElementById(`agent-${agentId}`);
                if (card) {
                    card.classList.add('active', 'speaking');
                    const statusEl = card.querySelector('.agent-status');
                    statusEl.classList.add(status);
                }
            }
        }

        function addMessage(agent, type, text) {
            const container = document.getElementById('messages');
            if (messageCount === 0) {
                container.innerHTML = '';
            }

            const avatars = {
                leader: 'üëî',
                worker1: '‚öôÔ∏è',
                critic: 'üîç',
                memory: 'üß†'
            };

            const names = {
                leader: 'Coordinator',
                worker1: 'Developer',
                critic: 'Reviewer',
                memory: 'Knowledge'
            };

            const typeColors = {
                directive: '#f97316',
                assignment: '#3b82f6',
                response: '#22c55e',
                progress: '#fbbf24',
                review: '#ef4444',
                approval: '#22c55e',
                update: '#8b5cf6',
                complete: '#f97316'
            };

            const msg = document.createElement('div');
            msg.className = `message from-${agent}`;
            msg.innerHTML = `
                <div class="message-avatar">${avatars[agent]}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">${names[agent]}</span>
                        <span class="message-type" style="color:${typeColors[type]}">${type}</span>
                    </div>
                    <div class="message-text">${text}</div>
                </div>
            `;

            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
            messageCount++;
            document.getElementById('msgCount').textContent = messageCount;
        }

        function updateSubtask(index, status) {
            const subtasks = document.querySelectorAll('.subtask');
            if (subtasks[index]) {
                const statusEl = subtasks[index].querySelector('.subtask-status');
                statusEl.className = `subtask-status ${status}`;
                if (status === 'done') {
                    statusEl.textContent = '‚úì';
                    completedTasks++;
                    document.getElementById('taskCount').textContent = `${completedTasks}/4`;
                } else if (status === 'progress') {
                    statusEl.textContent = '‚ãØ';
                } else if (status === 'review') {
                    statusEl.textContent = '?';
                }
            }
        }

        async function step() {
            const scenario = scenarios[currentScenario];
            if (currentStep >= scenario.steps.length) {
                return false;
            }

            const stepData = scenario.steps[currentStep];

            // Set agent active
            setAgentActive(stepData.agent, 'thinking');
            await delay(200);

            // Add message
            addMessage(stepData.agent, stepData.type, stepData.text);
            setAgentActive(stepData.agent, 'active');

            // Update subtask status based on step
            if (currentStep === 0) updateSubtask(0, 'progress');
            if (currentStep === 3) { updateSubtask(0, 'done'); updateSubtask(1, 'progress'); }
            if (currentStep === 5) updateSubtask(1, 'done');
            if (currentStep === 6) updateSubtask(2, 'progress');
            if (currentStep === 7) updateSubtask(2, 'review');
            if (currentStep === 10) updateSubtask(2, 'done');
            if (currentStep === 12) { updateSubtask(3, 'done'); }

            document.getElementById('iterCount').textContent = currentStep + 1;
            currentStep++;

            return currentStep < scenario.steps.length;
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function runCollaboration() {
            if (running) {
                running = false;
                return;
            }

            resetCollaboration();
            running = true;
            const speed = parseInt(document.getElementById('speed').value);

            while (running && await step()) {
                await delay(speed);
            }

            running = false;
            setAgentActive(null);
        }

        async function stepCollaboration() {
            await step();
            setAgentActive(null);
        }

        function resetCollaboration() {
            running = false;
            currentStep = 0;
            messageCount = 0;
            completedTasks = 0;

            document.getElementById('messages').innerHTML = `
                <div style="color:#666; text-align:center; padding:30px;">
                    Start the collaboration to see agent communication...
                </div>
            `;

            document.getElementById('msgCount').textContent = '0';
            document.getElementById('taskCount').textContent = '0/4';
            document.getElementById('iterCount').textContent = '0';

            document.querySelectorAll('.subtask-status').forEach((el, i) => {
                el.className = 'subtask-status pending';
                el.textContent = i + 1;
            });

            setAgentActive(null);
        }
    </script>
</body>
</html>
